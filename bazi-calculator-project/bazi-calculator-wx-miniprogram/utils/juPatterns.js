// utils/juPatterns.js

// 格局分析模块

// 判断格局类型
function analyzeJuPattern(params) {
  const { dayGan, monthZhi } = params;
  const types = [];
  let explanation = '';
  let characteristics = '';
  
  // 根据日干和月支直接判断格局
  const juPatternMap = {
    '子': {
      '甲': '印重局', '乙': '印重局', '丙': '煞重局', '丁': '煞重局', '戊': '财旺局',
      '己': '财旺局', '庚': '伤官局', '辛': '伤官局', '壬': '比肩局', '癸': '比肩局'
    },
    '丑': {
      '甲': '财旺局', '乙': '财旺局', '丙': '伤官局', '丁': '伤官局', '戊': '比肩局',
      '己': '比肩局', '庚': '印重局', '辛': '印重局', '壬': '煞重局', '癸': '煞重局'
    },
    '寅': {
      '甲': '比肩局', '乙': '比肩局', '丙': '印重局', '丁': '印重局', '戊': '煞重局',
      '己': '煞重局', '庚': '财旺局', '辛': '财旺局', '壬': '伤官局', '癸': '伤官局'
    },
    '卯': {
      '甲': '比肩局', '乙': '比肩局', '丙': '印重局', '丁': '印重局', '戊': '煞重局',
      '己': '煞重局', '庚': '财旺局', '辛': '财旺局', '壬': '伤官局', '癸': '伤官局'
    },
    '辰': {
      '甲': '财旺局', '乙': '财旺局', '丙': '伤官局', '丁': '伤官局', '戊': '比肩局',
      '己': '比肩局', '庚': '印重局', '辛': '印重局', '壬': '煞重局', '癸': '煞重局'
    },
    '巳': {
      '甲': '伤官局', '乙': '伤官局', '丙': '比肩局', '丁': '比肩局', '戊': '印重局',
      '己': '印重局', '庚': '煞重局', '辛': '煞重局', '壬': '财旺局', '癸': '财旺局'
    },
    '午': {
      '甲': '伤官局', '乙': '伤官局', '丙': '比肩局', '丁': '比肩局', '戊': '印重局',
      '己': '印重局', '庚': '煞重局', '辛': '煞重局', '壬': '财旺局', '癸': '财旺局'
    },
    '未': {
      '甲': '财旺局', '乙': '财旺局', '丙': '伤官局', '丁': '伤官局', '戊': '比肩局',
      '己': '比肩局', '庚': '印重局', '辛': '印重局', '壬': '煞重局', '癸': '煞重局'
    },
    '申': {
      '甲': '煞重局', '乙': '煞重局', '丙': '财旺局', '丁': '财旺局', '戊': '伤官局',
      '己': '伤官局', '庚': '比肩局', '辛': '比肩局', '壬': '印重局', '癸': '印重局'
    },
    '酉': {
      '甲': '煞重局', '乙': '煞重局', '丙': '财旺局', '丁': '财旺局', '戊': '伤官局',
      '己': '伤官局', '庚': '比肩局', '辛': '比肩局', '壬': '印重局', '癸': '印重局'
    },
    '戌': {
      '甲': '财旺局', '乙': '财旺局', '丙': '伤官局', '丁': '伤官局', '戊': '比肩局',
      '己': '比肩局', '庚': '印重局', '辛': '印重局', '壬': '煞重局', '癸': '煞重局'
    },
    '亥': {
      '甲': '印重局', '乙': '印重局', '丙': '煞重局', '丁': '煞重局', '戊': '财旺局',
      '己': '财旺局', '庚': '伤官局', '辛': '伤官局', '壬': '比肩局', '癸': '比肩局'
    }
  };
  
  const pattern = juPatternMap[monthZhi][dayGan];
  types.push(pattern);
  
  // 根据格局类型设置解释和特征
  switch (pattern) {
    case '印重局':
      explanation = '印绶格局。印绶格指日主弱，喜用神为印绶，即生助日主之五行。';
      characteristics = '性格温和，重视学习和知识，有贵人相助，适合从事学术、教育、文化等领域。';
      break;
    case '财旺局':
      explanation = '财官双美格局。财官双美指日主强，喜用神为财星和官星，即我克者为财，克我者为官。';
      characteristics = '性格开朗自信，事业心强，适合从事管理、经商等领域，有较强的组织能力和领导才能。';
      break;
    case '煞重局':
      explanation = '七杀格局。七杀格指日主强，喜用神为七杀，即克制日主之五行。';
      characteristics = '性格刚毅果断，有决断力，适合从事竞争性行业，有较强的进取精神和冒险精神。';
      break;
    case '伤官局':
      explanation = '伤官格局。伤官格指日主中和，喜用神为伤官，即克制日主之五行。';
      characteristics = '性格灵活聪慧，善于变通，适合从事创新性工作，有较强的创造力和独特见解。';
      break;
    case '比肩局':
      explanation = '比肩格局。比肩格指日主得助，喜用神为比肩，即与日主同五行。';
      characteristics = '性格坚韧稳重，重视合作，适合从事团队工作，有较强的协调能力和执行力。';
      break;
  }
  
  return {
    types,
    explanation,
    characteristics
  };
}

module.exports = {
  analyzeJuPattern
};