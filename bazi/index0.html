<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>八字格局分析</title>
    <style>
        :root {
            --primary-color: #3c1053;
            --secondary-color: #ad5389;
            --text-color: #f1e7fa;
            --accent-color: #e8b923;
            --bg-dark: #120727;
            --bg-light: #23084d;
        }
        
        body {
            margin: 0;
            padding: 0;
            font-family: 'Ma Shan Zheng', 'STKaiti', sans-serif;
            background: linear-gradient(135deg, var(--bg-dark), var(--bg-light));
            color: var(--text-color);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }
        
        h1 {
            font-size: 2.8rem;
            margin: 10px 0;
            color: var(--accent-color);
            text-shadow: 0 0 10px rgba(232, 185, 35, 0.5);
            letter-spacing: 2px;
        }
        
        .form-container {
            background: rgba(60, 16, 83, 0.5);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(5px);
            margin-bottom: 30px;
            border: 1px solid rgba(232, 185, 35, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .form-container::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(232, 185, 35, 0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
            z-index: -1;
        }
        
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-size: 1.1rem;
            color: var(--accent-color);
        }
        
        select, input {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(232, 185, 35, 0.5);
            background: rgba(0, 0, 0, 0.2);
            color: var(--text-color);
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s ease;
        }
        
        select:focus, input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 10px rgba(232, 185, 35, 0.5);
        }
        
        button {
            grid-column: 1 / -1;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: var(--text-color);
            border: none;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            margin-top: 10px;
            position: relative;
            overflow: hidden;
            font-family: inherit;
        }
        
        button::after {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.2) 0%, transparent 60%);
            transform: scale(0);
            opacity: 0;
            transition: transform 0.5s, opacity 0.5s;
        }
        
        button:hover {
            background: linear-gradient(45deg, var(--secondary-color), var(--primary-color));
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transform: translateY(-2px);
        }
        
        button:hover::after {
            transform: scale(1);
            opacity: 1;
        }
        
        .result-container {
            display: none;
            background: rgba(60, 16, 83, 0.5);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(232, 185, 35, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .result-container::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(232, 185, 35, 0.1) 0%, transparent 70%);
            animation: rotateSlower 30s linear infinite;
            z-index: -1;
        }
        
        @keyframes rotateSlower {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .bazi-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .bazi-item {
            position: relative;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 20px 10px;
            border: 1px solid rgba(232, 185, 35, 0.3);
            transition: all 0.3s ease;
            animation: pulse 2s infinite alternate;
            opacity: 0; /* 初始透明，用于fadeIn动画 */
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 5px rgba(232, 185, 35, 0.2); }
            100% { box-shadow: 0 0 15px rgba(232, 185, 35, 0.5); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .bazi-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .bazi-item h3 {
            margin: 0 0 10px 0;
            color: var(--accent-color);
            font-size: 1.2rem;
        }
        
        .bazi-character {
            font-size: 2.5rem;
            margin: 0;
            color: var(--text-color);
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }
        
        .element {
            font-size: 1rem;
            color: var(--accent-color);
            margin-top: 5px;
        }
        
        .divider {
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent-color), transparent);
            margin: 30px 0;
            position: relative;
        }
        
        .divider::before {
            content: "✧";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-light);
            padding: 0 15px;
            color: var(--accent-color);
        }
        
        .pattern-title {
            text-align: center;
            font-size: 1.8rem;
            color: var(--accent-color);
            margin: 20px 0;
            text-shadow: 0 0 10px rgba(232, 185, 35, 0.5);
            animation: glow 2s infinite alternate;
        }
        
        @keyframes glow {
            0% { text-shadow: 0 0 5px rgba(232, 185, 35, 0.5); }
            100% { text-shadow: 0 0 15px rgba(232, 185, 35, 0.8), 0 0 20px rgba(232, 185, 35, 0.5); }
        }
        
        .pattern-description {
            text-align: justify;
            line-height: 1.8;
            font-size: 1.1rem;
            margin-bottom: 30px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 20px;
            position: relative;
            border: 1px solid rgba(232, 185, 35, 0.3);
        }
        
        .analysis-section {
            margin-top: 30px;
        }
        
        .analysis-section h3 {
            color: var(--accent-color);
            font-size: 1.4rem;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(232, 185, 35, 0.3);
            padding-bottom: 10px;
        }
        
        .analysis-section p {
            line-height: 1.8;
        }
        
        .floating-elements {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }
        
        .element-symbol {
            position: absolute;
            font-size: 1.5rem;
            color: rgba(232, 185, 35, 0.2);
            animation: float 20s linear infinite;
            text-shadow: 0 0 5px rgba(232, 185, 35, 0.2);
        }
        
        @keyframes float {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 0;
            }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% {
                transform: translateY(-100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        .loading {
            display: none; /* 默认隐藏 */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        
        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 5px solid rgba(232, 185, 35, 0.3);
            border-radius: 50%;
            border-top: 5px solid var(--accent-color);
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            margin-top: 20px;
            color: var(--accent-color);
            font-size: 1.2rem;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .form-container, .result-container {
                padding: 20px;
            }
            
            .bazi-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .bazi-character {
                font-size: 2rem;
            }
        }
        
        @import url('https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&display=swap');
    </style>
</head>
<body>
    <div class="floating-elements" id="floatingElements"></div>
    
    <div class="loading" id="loadingScreen" style="display: none;">
        <div class="loading-spinner"></div>
        <div class="loading-text">正在推算命格，请稍候...</div>
    </div>
    
    <div class="container">
        <header>
            <h1>八字格局分析</h1>
        </header>
        
        <div class="form-container">
            <form id="baziForm">
                <div class="form-group">
                    <label for="year">出生年份</label>
                    <select id="year" required>
                        <option value="">请选择</option>
                        <option value="1940">1940年</option>
                        <option value="1941">1941年</option>
                        <option value="1942">1942年</option>
                        <option value="1943">1943年</option>
                        <option value="1944">1944年</option>
                        <option value="1945">1945年</option>
                        <option value="1946">1946年</option>
                        <option value="1947">1947年</option>
                        <option value="1948">1948年</option>
                        <option value="1949">1949年</option>
                        <option value="1950">1950年</option>
                        <option value="1951">1951年</option>
                        <option value="1952">1952年</option>
                        <option value="1953">1953年</option>
                        <option value="1954">1954年</option>
                        <option value="1955">1955年</option>
                        <option value="1956">1956年</option>
                        <option value="1957">1957年</option>
                        <option value="1958">1958年</option>
                        <option value="1959">1959年</option>
                        <option value="1960">1960年</option>
                        <option value="1961">1961年</option>
                        <option value="1962">1962年</option>
                        <option value="1963">1963年</option>
                        <option value="1964">1964年</option>
                        <option value="1965">1965年</option>
                        <option value="1966">1966年</option>
                        <option value="1967">1967年</option>
                        <option value="1968">1968年</option>
                        <option value="1969">1969年</option>
                        <option value="1970">1970年</option>
                        <option value="1971">1971年</option>
                        <option value="1972">1972年</option>
                        <option value="1973">1973年</option>
                        <option value="1974">1974年</option>
                        <option value="1975">1975年</option>
                        <option value="1976">1976年</option>
                        <option value="1977">1977年</option>
                        <option value="1978">1978年</option>
                        <option value="1979">1979年</option>
                        <option value="1980">1980年</option>
                        <option value="1981">1981年</option>
                        <option value="1982">1982年</option>
                        <option value="1983">1983年</option>
                        <option value="1984">1984年</option>
                        <option value="1985">1985年</option>
                        <option value="1986">1986年</option>
                        <option value="1987">1987年</option>
                        <option value="1988">1988年</option>
                        <option value="1989">1989年</option>
                        <option value="1990">1990年</option>
                        <option value="1991">1991年</option>
                        <option value="1992">1992年</option>
                        <option value="1993">1993年</option>
                        <option value="1994">1994年</option>
                        <option value="1995">1995年</option>
                        <option value="1996">1996年</option>
                        <option value="1997">1997年</option>
                        <option value="1998">1998年</option>
                        <option value="1999">1999年</option>
                        <option value="2000">2000年</option>
                        <option value="2001">2001年</option>
                        <option value="2002">2002年</option>
                        <option value="2003">2003年</option>
                        <option value="2004">2004年</option>
                        <option value="2005">2005年</option>
                        <option value="2006">2006年</option>
                        <option value="2007">2007年</option>
                        <option value="2008">2008年</option>
                        <option value="2009">2009年</option>
                        <option value="2010">2010年</option>
                        <option value="2011">2011年</option>
                        <option value="2012">2012年</option>
                        <option value="2013">2013年</option>
                        <option value="2014">2014年</option>
                        <option value="2015">2015年</option>
                        <option value="2016">2016年</option>
                        <option value="2017">2017年</option>
                        <option value="2018">2018年</option>
                        <option value="2019">2019年</option>
                        <option value="2020">2020年</option>
                        <option value="2021">2021年</option>
                        <option value="2022">2022年</option>
                        <option value="2023">2023年</option>
                        <option value="2024">2024年</option>
                        <option value="2025">2025年</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="month">出生月份</label>
                    <select id="month" required>
                        <option value="">请选择</option>
                        <option value="1">正月</option>
                        <option value="2">二月</option>
                        <option value="3">三月</option>
                        <option value="4">四月</option>
                        <option value="5">五月</option>
                        <option value="6">六月</option>
                        <option value="7">七月</option>
                        <option value="8">八月</option>
                        <option value="9">九月</option>
                        <option value="10">十月</option>
                        <option value="11">十一月</option>
                        <option value="12">十二月</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="day">出生日</label>
                    <select id="day" required>
                        <option value="">请选择</option>
                        <option value="1">初一</option>
                        <option value="2">初二</option>
                        <option value="3">初三</option>
                        <option value="4">初四</option>
                        <option value="5">初五</option>
                        <option value="6">初六</option>
                        <option value="7">初七</option>
                        <option value="8">初八</option>
                        <option value="9">初九</option>
                        <option value="10">初十</option>
                        <option value="11">十一</option>
                        <option value="12">十二</option>
                        <option value="13">十三</option>
                        <option value="14">十四</option>
                        <option value="15">十五</option>
                        <option value="16">十六</option>
                        <option value="17">十七</option>
                        <option value="18">十八</option>
                        <option value="19">十九</option>
                        <option value="20">二十</option>
                        <option value="21">廿一</option>
                        <option value="22">廿二</option>
                        <option value="23">廿三</option>
                        <option value="24">廿四</option>
                        <option value="25">廿五</option>
                        <option value="26">廿六</option>
                        <option value="27">廿七</option>
                        <option value="28">廿八</option>
                        <option value="29">廿九</option>
                        <option value="30">三十</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="hour">出生时辰</label>
                    <select id="hour" required>
                        <option value="">请选择</option>
                        <option value="1">子时 (23:00-00:59)</option>
                        <option value="2">丑时 (01:00-02:59)</option>
                        <option value="3">寅时 (03:00-04:59)</option>
                        <option value="4">卯时 (05:00-06:59)</option>
                        <option value="5">辰时 (07:00-08:59)</option>
                        <option value="6">巳时 (09:00-10:59)</option>
                        <option value="7">午时 (11:00-12:59)</option>
                        <option value="8">未时 (13:00-14:59)</option>
                        <option value="9">申时 (15:00-16:59)</option>
                        <option value="10">酉时 (17:00-18:59)</option>
                        <option value="11">戌时 (19:00-20:59)</option>
                        <option value="12">亥时 (21:00-22:59)</option>
                    </select>
                </div>
                
                <button type="submit">推算八字格局</button>
            </form>
        </div>
        
        <div class="result-container" id="resultContainer">
            <div class="bazi-grid" id="baziGrid">
                <!-- 八字内容将由JavaScript动态生成 -->
            </div>
            
            <div class="divider"></div>
            
            <h2 class="pattern-title" id="patternTitle">命局分析结果</h2>
            
            <div class="pattern-description" id="patternDescription">
                <!-- 格局描述将由JavaScript动态生成 -->
            </div>
            
            <div class="analysis-section">
                <h3>五行分析</h3>
                <p id="elementAnalysis"><!-- 五行分析将由JavaScript动态生成 --></p>
            </div>
            
            <div class="analysis-section">
                <h3>日主强弱</h3>
                <p id="dayMasterAnalysis"><!-- 日主分析将由JavaScript动态生成 --></p>
            </div>
            
            <div class="analysis-section">
                <h3>十神组合</h3>
                <p id="godAnalysis"><!-- 十神组合分析将由JavaScript动态生成 --></p>
            </div>
        </div>
    </div>
    
    <script>
        // 天干地支数据
        const heavenlyStems = ["甲", "乙", "丙", "丁", "戊", "己", "庚", "辛", "壬", "癸"];
        const earthlyBranches = ["子", "丑", "寅", "卯", "辰", "巳", "午", "未", "申", "酉", "戌", "亥"];
        const hoursNames = ["子", "丑", "寅", "卯", "辰", "巳", "午", "未", "申", "酉", "戌", "亥"];
        
        // 五行属性
        const elements = {
            "甲": "木", "乙": "木",
            "丙": "火", "丁": "火",
            "戊": "土", "己": "土",
            "庚": "金", "辛": "金",
            "壬": "水", "癸": "水",
            "子": "水", "丑": "土",
            "寅": "木", "卯": "木",
            "辰": "土", "巳": "火",
            "午": "火", "未": "土",
            "申": "金", "酉": "金",
            "戌": "土", "亥": "水"
        };
        
        // 五行生克关系
        const elementRelations = {
            "木": { "生": "火", "克": "土", "被生": "水", "被克": "金" },
            "火": { "生": "土", "克": "金", "被生": "木", "被克": "水" },
            "土": { "生": "金", "克": "水", "被生": "火", "被克": "木" },
            "金": { "生": "水", "克": "木", "被生": "土", "被克": "火" },
            "水": { "生": "木", "克": "火", "被生": "金", "被克": "土" }
        };
        
        // 十神名称
        const tenGods = {
            "木甲": { "木甲": "比肩", "木乙": "劫财", "火丙": "食神", "火丁": "伤官", "土戊": "偏财", "土己": "正财", "金庚": "七杀", "金辛": "正官", "水壬": "偏印", "水癸": "正印" },
            "木乙": { "木甲": "劫财", "木乙": "比肩", "火丙": "伤官", "火丁": "食神", "土戊": "正财", "土己": "偏财", "金庚": "正官", "金辛": "七杀", "水壬": "正印", "水癸": "偏印" },
            "火丙": { "木甲": "偏印", "木乙": "正印", "火丙": "比肩", "火丁": "劫财", "土戊": "食神", "土己": "伤官", "金庚": "偏财", "金辛": "正财", "水壬": "七杀", "水癸": "正官" },
            "火丁": { "木甲": "正印", "木乙": "偏印", "火丙": "劫财", "火丁": "比肩", "土戊": "伤官", "土己": "食神", "金庚": "正财", "金辛": "偏财", "水壬": "正官", "水癸": "七杀" },
            "土戊": { "木甲": "七杀", "木乙": "正官", "火丙": "偏印", "火丁": "正印", "土戊": "比肩", "土己": "劫财", "金庚": "食神", "金辛": "伤官", "水壬": "偏财", "水癸": "正财" },
            "土己": { "木甲": "正官", "木乙": "七杀", "火丙": "正印", "火丁": "偏印", "土戊": "劫财", "土己": "比肩", "金庚": "伤官", "金辛": "食神", "水壬": "正财", "水癸": "偏财" },
            "金庚": { "木甲": "偏财", "木乙": "正财", "火丙": "七杀", "火丁": "正官", "土戊": "偏印", "土己": "正印", "金庚": "比肩", "金辛": "劫财", "水壬": "食神", "水癸": "伤官" },
            "金辛": { "木甲": "正财", "木乙": "偏财", "火丙": "正官", "火丁": "七杀", "土戊": "正印", "土己": "偏印", "金庚": "劫财", "金辛": "比肩", "水壬": "伤官", "水癸": "食神" },
            "水壬": { "木甲": "食神", "木乙": "伤官", "火丙": "偏财", "火丁": "正财", "土戊": "七杀", "土己": "正官", "金庚": "偏印", "金辛": "正印", "水壬": "比肩", "水癸": "劫财" },
            "水癸": { "木甲": "伤官", "木乙": "食神", "火丙": "正财", "火丁": "偏财", "土戊": "正官", "土己": "七杀", "金庚": "正印", "金辛": "偏印", "水壬": "劫财", "水癸": "比肩" }
        };
        
        // 格局特征映射
        const patternCharacteristics = {
            "伤官局": {
                description: "伤官局的人感性多于理性，思维活跃，富有艺术家气质。他们对他人有很强的同理心和理解能力，善于观察世界以及人与人之间的关系，热衷于感受美好的事物。",
                traits: ["伤官", "食神", "感性", "艺术气质", "同理心"],
                dayMaster: "较弱",
                element: "以日主五行所生的五行为主"
            },
            "印中局": {
                description: "印中局的人理性占主导，喜欢讲道理，性格较为固执，不太容易听取他人的意见，自我意识很强。",
                traits: ["正印", "偏印", "理性", "自我", "固执"],
                dayMaster: "中等",
                element: "以日主五行所生的五行为主"
            },
            "比肩局": {
                description: "比肩局的人重义气，朋友通常较多，在团队中往往是兜底的角色，不怕辛苦，勇于担当。",
                traits: ["比肩", "劫财", "义气", "担当", "团队"],
                dayMaster: "强",
                element: "日主五行过旺"
            },
            "煞重局": {
                description: "煞重局的人风险意识强，做事情注重细节。他们往往有很强的执行力，对潜在问题有敏锐的洞察力。",
                traits: ["七杀", "正官", "风险意识", "细节", "执行"],
                dayMaster: "弱",
                element: "以日主五行所克的五行为主"
            },
            "财旺局": {
                description: "财旺局的人执行能力强，他们将事业成功视为衡量自己的标准，同时也用这一标准去评判他人。在'想了再做'和'做了再想'之间，他们通常会选择后者。",
                traits: ["正财", "偏财", "执行力", "务实", "结果导向"],
                dayMaster: "中弱",
                element: "以日主五行所克的五行为主"
            }
        };
        
        // 更新农历月份对应的日期选项
        function updateDayOptions(month) {
            const daySelect = document.getElementById('day');
            const options = daySelect.querySelectorAll('option');
            let maxDays = 30; // 默认大月
            if ([2, 4, 6, 9, 11].includes(parseInt(month))) {
                maxDays = 29; // 小月
            }
            for (let i = 1; i < options.length; i++) {
                const day = parseInt(options[i].value);
                options[i].style.display = day <= maxDays ? '' : 'none';
            }
        }
        
        // 计算农历年的天干地支（简化版，建议使用专业农历库）
        function getLunarYearGanZhi(year) {
            const baseYear = 1900; // 1900年为庚子年
            const ganIndex = (year - baseYear) % 10;
            const zhiIndex = (year - baseYear) % 12;
            return {
                gan: heavenlyStems[(ganIndex + 6) % 10], // 庚为第7天干
                zhi: earthlyBranches[(zhiIndex + 0) % 12] // 子为第1地支
            };
        }
        
        // 简化的农历月干支计算（建议使用专业农历库）
        function getLunarMonthGanZhi(year, month) {
            const yearGan = getLunarYearGanZhi(year).gan;
            const ganStartIndex = heavenlyStems.indexOf(yearGan);
            let ganIndex = (ganStartIndex * 2 + parseInt(month) + 2) % 10;
            let zhiIndex = (parseInt(month) + 2 - 1) % 12;
            return {
                gan: heavenlyStems[ganIndex],
                zhi: earthlyBranches[zhiIndex]
            };
        }
        
        // 简化的农历日干支计算（建议使用专业农历库）
        function getLunarDayGanZhi(year, month, day) {
            const baseDate = new Date(1900, 0, 1); // 1900年1月1日为甲子日
            const targetDate = new Date(year, month - 1, day);
            const diffDays = Math.floor((targetDate - baseDate) / (24 * 60 * 60 * 1000));
            const ganIndex = diffDays % 10;
            const zhiIndex = diffDays % 12;
            return {
                gan: heavenlyStems[ganIndex],
                zhi: earthlyBranches[zhiIndex]
            };
        }
        
        // 获取时辰干支
        function getHourGanZhi(dayGan, hour) {
            let startGan;
            switch (dayGan) {
                case "甲": case "己": startGan = 0; break; // 甲
                case "乙": case "庚": startGan = 2; break; // 丙
                case "丙": case "辛": startGan = 4; break; // 戊
                case "丁": case "壬": startGan = 6; break; // 庚
                case "戊": case "癸": startGan = 8; break; // 壬
                default: startGan = 0;
            }
            const ganIndex = (startGan + Math.floor((hour - 1) / 2)) % 10;
            const zhiIndex = hour - 1; // hour从1到12对应子到亥
            return {
                gan: heavenlyStems[ganIndex],
                zhi: earthlyBranches[zhiIndex]
            };
        }
        
        // 计算八字
        function calculateBazi(year, month, day, hour) {
            const yearGanZhi = getLunarYearGanZhi(year);
            const monthGanZhi = getLunarMonthGanZhi(year, month);
            const dayGanZhi = getLunarDayGanZhi(year, month, day);
            const hourGanZhi = getHourGanZhi(dayGanZhi.gan, hour);
            return {
                year: { gan: yearGanZhi.gan, zhi: yearGanZhi.zhi, element: elements[yearGanZhi.gan] },
                month: { gan: monthGanZhi.gan, zhi: monthGanZhi.zhi, element: elements[monthGanZhi.gan] },
                day: { gan: dayGanZhi.gan, zhi: dayGanZhi.zhi, element: elements[dayGanZhi.gan] },
                hour: { gan: hourGanZhi.gan, zhi: hourGanZhi.zhi, element: elements[hourGanZhi.gan] }
            };
        }
        
        // 分析八字五行分布
        function analyzeElements(bazi) {
            const elementCount = { "木": 0, "火": 0, "土": 0, "金": 0, "水": 0 };
            elementCount[elements[bazi.year.gan]]++;
            elementCount[elements[bazi.month.gan]]++;
            elementCount[elements[bazi.day.gan]]++;
            elementCount[elements[bazi.hour.gan]]++;
            elementCount[elements[bazi.year.zhi]]++;
            elementCount[elements[bazi.month.zhi]]++;
            elementCount[elements[bazi.day.zhi]]++;
            elementCount[elements[bazi.hour.zhi]]++;
            return elementCount;
        }
        
        // 分析日主强弱
        function analyzeDayMaster(bazi, elementCount) {
            const dayMasterElement = elements[bazi.day.gan];
            let supportCount = elementCount[dayMasterElement] + elementCount[elementRelations[dayMasterElement].被生];
            let weakenCount = elementCount[elementRelations[dayMasterElement].克] + elementCount[elementRelations[dayMasterElement].生];
            if (supportCount > weakenCount + 2) return { strength: "极强", description: "日主旺盛，根基稳固，有魄力和领导气质。" };
            if (supportCount > weakenCount) return { strength: "强", description: "日主较强，个性坚定，有主见，适合担当重任。" };
            if (supportCount === weakenCount) return { strength: "中和", description: "日主中和，性格平稳，能权衡利弊，适应性强。" };
            if (weakenCount > supportCount + 2) return { strength: "极弱", description: "日主虚弱，需要扶助，性格敏感，易受环境影响。" };
            return { strength: "弱", description: "日主偏弱，性格温和，有韧性，善于合作。" };
        }
        
        // 分析十神组合
        function analyzeGods(bazi) {
            const dayGan = bazi.day.gan;
            const dayElement = elements[dayGan];
            const gods = {
                yearGan: tenGods[dayElement + dayGan][elements[bazi.year.gan] + bazi.year.gan],
                monthGan: tenGods[dayElement + dayGan][elements[bazi.month.gan] + bazi.month.gan],
                hourGan: tenGods[dayElement + dayGan][elements[bazi.hour.gan] + bazi.hour.gan]
            };
            const godCounts = {};
            Object.values(gods).forEach(god => godCounts[god] = (godCounts[god] || 0) + 1);
            return { gods, godCounts };
        }
        
        // 确定命局格局
        function determinePattern(bazi, dayMasterAnalysis, elementCount, godAnalysis) {
            const dayMasterElement = elements[bazi.day.gan];
            let scores = { "伤官局": 0, "印中局": 0, "比肩局": 0, "煞重局": 0, "财旺局": 0 };
            if (dayMasterAnalysis.strength === "极强" || dayMasterAnalysis.strength === "强") {
                scores["比肩局"] += 3; scores["伤官局"] += 1;
            } else if (dayMasterAnalysis.strength === "中和") {
                scores["印中局"] += 2; scores["伤官局"] += 1; scores["财旺局"] += 1;
            } else {
                scores["煞重局"] += 2; scores["财旺局"] += 2; scores["印中局"] += 1;
            }
            const maxElement = Object.entries(elementCount).reduce((a, b) => a[1] > b[1] ? a : b)[0];
            if (maxElement === dayMasterElement) scores["比肩局"] += 3;
            else if (maxElement === elementRelations[dayMasterElement].生) scores["伤官局"] += 3;
            else if (maxElement === elementRelations[dayMasterElement].被生) scores["印中局"] += 3;
            else if (maxElement === elementRelations[dayMasterElement].克) scores["煞重局"] += 3;
            else if (maxElement === elementRelations[dayMasterElement].被克) scores["财旺局"] += 3;
            const { godCounts } = godAnalysis;
            if (godCounts["伤官"] || godCounts["食神"]) scores["伤官局"] += (godCounts["伤官"] || 0) * 2 + (godCounts["食神"] || 0) * 1;
            if (godCounts["正印"] || godCounts["偏印"]) scores["印中局"] += (godCounts["正印"] || 0) * 2 + (godCounts["偏印"] || 0) * 1;
            if (godCounts["比肩"] || godCounts["劫财"]) scores["比肩局"] += (godCounts["比肩"] || 0) * 2 + (godCounts["劫财"] || 0) * 1;
            if (godCounts["七杀"] || godCounts["正官"]) scores["煞重局"] += (godCounts["七杀"] || 0) * 2 + (godCounts["正官"] || 0) * 1;
            if (godCounts["正财"] || godCounts["偏财"]) scores["财旺局"] += (godCounts["正财"] || 0) * 2 + (godCounts["偏财"] || 0) * 1;
            return Object.entries(scores).reduce((a, b) => a[1] > b[1] ? a : b)[0];
        }
        
        // 显示八字结果
        function displayBaziResult(bazi, pattern, elementCount, dayMasterAnalysis, godAnalysis) {
            const resultContainer = document.getElementById('resultContainer');
            const baziGrid = document.getElementById('baziGrid');
            const patternTitle = document.getElementById('patternTitle');
            const patternDescription = document.getElementById('patternDescription');
            const elementAnalysis = document.getElementById('elementAnalysis');
            const dayMasterAnalysisEl = document.getElementById('dayMasterAnalysis');
            const godAnalysisEl = document.getElementById('godAnalysis');
            
            baziGrid.innerHTML = '';
            const columns = [
                { title: "年柱", gan: bazi.year.gan, zhi: bazi.year.zhi, element: bazi.year.element },
                { title: "月柱", gan: bazi.month.gan, zhi: bazi.month.zhi, element: bazi.month.element },
                { title: "日柱", gan: bazi.day.gan, zhi: bazi.day.zhi, element: bazi.day.element },
                { title: "时柱", gan: bazi.hour.gan, zhi: bazi.hour.zhi, element: bazi.hour.element }
            ];
            columns.forEach(column => {
                const pillarEl = document.createElement('div');
                pillarEl.className = 'bazi-item';
                pillarEl.innerHTML = `
                    <h3>${column.title}</h3>
                    <p class="bazi-character">${column.gan}${column.zhi}</p>
                    <p class="element">${column.element}</p>
                `;
                baziGrid.appendChild(pillarEl);
            });
            
            patternTitle.textContent = pattern;
            patternDescription.textContent = patternCharacteristics[pattern].description;
            
            let elementText = "您的八字中五行分布为：";
            for (const [element, count] of Object.entries(elementCount)) {
                elementText += `${element}(${count})、`;
            }
            elementText = elementText.slice(0, -1) + "。";
            const maxElement = Object.entries(elementCount).reduce((a, b) => a[1] > b[1] ? a : b);
            const minElement = Object.entries(elementCount).reduce((a, b) => a[1] < b[1] ? a : b);
            elementText += `其中${maxElement[0]}最为旺盛，${minElement[0]}较为薄弱。`;
            switch (pattern) {
                case "伤官局": elementText += `伤官格的人需要${elements[bazi.day.gan]}、${elementRelations[elements[bazi.day.gan]].被生}平衡发展，过分偏向任何一方都会影响运势。`; break;
                case "印中局": elementText += `印中格的人需要保持${elements[bazi.day.gan]}的稳定，${elementRelations[elements[bazi.day.gan]].被生}对您有辅助作用。`; break;
                case "比肩局": elementText += `比肩格的您${elements[bazi.day.gan]}气过旺，适当引入${elementRelations[elements[bazi.day.gan]].克}或${elementRelations[elements[bazi.day.gan]].生}来平衡。`; break;
                case "煞重局": elementText += `煞重格的您受到${elementRelations[elements[bazi.day.gan]].克}的制约，适当引入${elementRelations[elements[bazi.day.gan]].被生}可以改善运势。`; break;
                case "财旺局": elementText += `财旺格的您需要平衡${elements[bazi.day.gan]}和${elementRelations[elements[bazi.day.gan]].被克}之间的关系，避免过度追求物质导致失衡。`; break;
            }
            elementAnalysis.textContent = elementText;
            
            dayMasterAnalysisEl.textContent = `您的日主${bazi.day.gan}属${elements[bazi.day.gan]}，强度为${dayMasterAnalysis.strength}。${dayMasterAnalysis.description}`;
            
            const { gods } = godAnalysis;
            let godText = `您的八字中，年干为${gods.yearGan}，月干为${gods.monthGan}，时干为${gods.hourGan}。`;
            switch (pattern) {
                case "伤官局": godText += "伤官格局中，伤官和食神的出现使您思维活跃，具有创新能力，适合从事艺术、设计、创意等工作。"; break;
                case "印中局": godText += "印中格局下，正印和偏印的存在使您思维严谨，知识渊博，适合从事教育、研究、顾问等需要专业知识的工作。"; break;
                case "比肩局": godText += "比肩格局中，比肩和劫财的组合使您独立自主，合作精神强，适合团队工作或领导职位。"; break;
                case "煞重局": godText += "煞重格局中，七杀和正官的存在使您纪律性强，具有执行力，适合从事规范化、制度化的工作。"; break;
                case "财旺局": godText += "财旺格局下，正财和偏财的出现使您有经济头脑，善于把握机会，适合从事商业、投资等工作。"; break;
            }
            godAnalysisEl.textContent = godText;
            
            resultContainer.style.display = 'block';
            setTimeout(() => {
                const baziItems = document.querySelectorAll('.bazi-item');
                baziItems.forEach((item, index) => {
                    item.style.animation = `fadeIn 0.5s ease-out ${index * 0.2}s forwards`;
                });
            }, 100);
        }
        
        // 创建浮动元素特效
        function createFloatingElements() {
            const container = document.getElementById('floatingElements');
            const symbols = ["木", "火", "土", "金", "水", "甲", "乙", "丙", "丁", "戊", "己", "庚", "辛", "壬", "癸"];
            for (let i = 0; i < 40; i++) {
                const element = document.createElement('div');
                element.className = 'element-symbol';
                element.textContent = symbols[Math.floor(Math.random() * symbols.length)];
                element.style.left = `${Math.random() * 100}%`;
                element.style.bottom = `-${Math.random() * 20 + 5}%`;
                element.style.fontSize = `${Math.random() * 1.5 + 0.8}rem`;
                element.style.opacity = Math.random() * 0.5 + 0.2;
                const duration = Math.random() * 40 + 20;
                element.style.animation = `float ${duration}s linear infinite`;
                element.style.animationDelay = `${Math.random() * 40}s`;
                container.appendChild(element);
            }
        }
        
        // 显示加载动画
        function showLoading() {
            document.getElementById('loadingScreen').style.display = 'flex';
        }
        
        // 隐藏加载动画
        function hideLoading() {
            document.getElementById('loadingScreen').style.display = 'none';
        }
        
        // 页面加载时隐藏加载动画并初始化
        document.addEventListener('DOMContentLoaded', function() {
            hideLoading(); // 页面加载完成时隐藏加载动画
            createFloatingElements(); // 创建浮动元素
        });
        
        // 表单提交处理
        document.getElementById('baziForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const year = parseInt(document.getElementById('year').value);
            const month = parseInt(document.getElementById('month').value);
            const day = parseInt(document.getElementById('day').value);
            const hour = parseInt(document.getElementById('hour').value);
            
            if (!year || !month || !day || !hour) {
                alert('请完整填写所有选项！');
                return;
            }
            
            // 简单日期验证
            const maxDays = [2, 4, 6, 9, 11].includes(month) ? 29 : 30;
            if (day > maxDays) {
                alert(`您选择的月份最多有${maxDays}天，请重新选择日期！`);
                return;
            }
            
            showLoading();
            setTimeout(() => {
                try {
                    const bazi = calculateBazi(year, month, day, hour);
                    const elementCount = analyzeElements(bazi);
                    const dayMasterAnalysis = analyzeDayMaster(bazi, elementCount);
                    const godAnalysis = analyzeGods(bazi);
                    const pattern = determinePattern(bazi, dayMasterAnalysis, elementCount, godAnalysis);
                    displayBaziResult(bazi, pattern, elementCount, dayMasterAnalysis, godAnalysis);
                    document.getElementById('resultContainer').scrollIntoView({ behavior: 'smooth' });
                } catch (error) {
                    console.error('计算错误:', error);
                    alert('八字计算出错，请重试！');
                } finally {
                    hideLoading();
                }
            }, 2000);
        });
        
        // 月份改变时更新日期选项
        document.getElementById('month').addEventListener('change', function() {
            const monthValue = this.value;
            if (monthValue) updateDayOptions(monthValue);
        });
    </script>
</body>
</html>